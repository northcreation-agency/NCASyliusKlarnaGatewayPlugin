# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    locale: 'en'
    anders_bjorkland_sylius_klarna_gateway.checkout.klarna_secret: '%env(KLARNA_SECRET)%'
    anders_bjorkland_sylius_klarna_gateway.checkout.uri: '%env(KLARNA_CHECKOUT_URI)%'
    anders_bjorkland_sylius_klarna_gateway.api.username: '%env(KLARNA_USERNAME)%'
    anders_bjorkland_sylius_klarna_gateway.api.password: '%env(KLARNA_PASSWORD)%'
    anders_bjorkland_sylius_klarna_gateway.cypher.key: '%env(PAYUM_CYPHER_KEY)%'

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.

    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    AndersBjorkland\SyliusKlarnaGatewayPlugin\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones
    anders_bjorkland_sylius_klarna_gateway.klarna_checkout:
        class: Payum\Core\Bridge\Symfony\Builder\GatewayFactoryBuilder
        arguments: ['AndersBjorkland\SyliusKlarnaGatewayPlugin\Payum\KlarnaCheckoutGatewayFactory']
        tags:
            - { name: payum.gateway_factory_builder, factory: klarna_checkout }
    
    anders_bjorkland_sylius_klarna_gateway.form.type.klarna_checkout_gateway_configuration:
        class: AndersBjorkland\SyliusKlarnaGatewayPlugin\Form\Type\KlarnaCheckoutGatewayConfigurationType
        arguments: ['@anders_bjorkland_sylius_klarna_gateway.cypher']
        tags:
            - { name: sylius.gateway_configuration_type, type: klarna_checkout, label: 'Klarna Checkout' }
            - { name: form.type }
    
    anders_bjorkland_sylius_klarna_gateway.actions.capture:
        class: AndersBjorkland\SyliusKlarnaGatewayPlugin\Payum\Action\CaptureAction
        public: true
        arguments: [
            '@sylius.http_client',
            '@parameter_bag',
            '@sylius.tax_rate_resolver',
            '@sylius.order_processing.shipping_charges_processor'
        ]
        tags:
            - { name: payum.action, factory: klarna_checkout, alias: payum.action.capture }
    
    
    anders_bjorkland_sylius_klarna_gateway.cypher:
        class: Payum\Core\Bridge\Defuse\Security\DefuseCypher
        arguments: ['%anders_bjorkland_sylius_klarna_gateway.cypher.key%']
        public: true
